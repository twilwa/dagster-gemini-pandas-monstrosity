"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{81967:function(e,n,t){t.d(n,{$:function(){return GlobalAutomaterializationContent}});var r=t(81862),i=t(85333),s=t(58467),a=t(22970),o=t(52322),l=t(83601),c=t(22139),u=t(9676),d=t(54266),h=t(63832),f=t(82585),p=t(81308),m=t(25195),g=t(2784),v=t(89102),x=t(3490),j=t(80428),y=t(22370),k=t(55237),b=t(61935),S=t(71277),A=t(65767),InstanceAutomaterializationEvaluationHistoryTable=function(e){var n,t,r=e.setSelectedTick,i=e.setTableView,a=e.setTimerange,l=e.setParentStatuses,c=(0,s._)((0,S.q)({queryKey:"statuses",decode:(0,g.useCallback)(function(e){var n=e.statuses;return new Set(n?JSON.parse(n):[b.izS.STARTED,b.izS.SUCCESS,b.izS.FAILURE,b.izS.SKIPPED])},[]),encode:(0,g.useCallback)(function(e){return{statuses:JSON.stringify(Array.from(e))}},[])}),2),u=c[0],d=c[1],h=(0,A.l)({query:v.X,variables:{statuses:(0,g.useMemo)(function(){return Array.from(u)},[u])},nextCursorForResult:function(e){var n,t=e.autoMaterializeTicks;if(t.length)return null===(n=t[14])||void 0===n?void 0:n.id},getResultArray:function(e){return(null==e?void 0:e.autoMaterializeTicks)?e.autoMaterializeTicks:[]},pageSize:15}),f=h.queryResult,p=h.paginationProps;return(0,k.C4)(f,1e4,!p.hasPrevCursor),(0,g.useEffect)(function(){if(p.hasPrevCursor){var e=null===(n=f.data)||void 0===n?void 0:n.autoMaterializeTicks;if(e&&e.length){var n,t,r,i=null===(t=e[e.length-1])||void 0===t?void 0:t.timestamp,s=null===(r=e[0])||void 0===r?void 0:r.endTimestamp;i&&s&&a([i,s])}}else a(void 0)},[p.hasPrevCursor,null===(n=f.data)||void 0===n?void 0:n.autoMaterializeTicks,a]),(0,g.useEffect)(function(){p.hasPrevCursor?l(Array.from(u)):l(void 0)},[p.hasPrevCursor,l,u]),(0,o.jsx)(y.V,{loading:f.loading,ticks:(null===(t=f.data)||void 0===t?void 0:t.autoMaterializeTicks)||[],paginationProps:p,setSelectedTick:r,setStatuses:d,setTableView:i,statuses:u})},w=t(75168),E=t(54949),T=t(90437),C=t(85888),_=t(81966),GlobalAutomaterializationContent=function(){var e,n,t=(0,_.dx)(),y=(0,w.p)(),A=(0,E.WB)().permissions,O=(void 0===A?{}:A).canToggleAutoMaterialize,P=(0,s._)((0,g.useState)(!1),2),F=P[0],B=P[1],z=(0,s._)((0,g.useState)(void 0),2),I=z[0],N=z[1],L=(0,s._)((0,g.useState)(void 0),2),R=L[0],M=L[1],U=(0,g.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return R||I?{afterTimestamp:null==R?void 0:R[0],beforeTimestamp:null==R?void 0:R[1],statuses:I}:{afterTimestamp:(e-12e5)/1e3}},[I,R]),D=(0,s._)((0,l.t)(v.X),2),V=D[0],K=D[1],$=(0,g.useCallback)((0,r._)(function(){return(0,a.Jh)(this,function(e){switch(e.label){case 0:return[4,V({variables:U()})];case 1:return[2,e.sent()]}})}),[V,U]);(0,k.bT)({refresh:$,enabled:!F&&!R&&!I,intervalMs:2e3,leading:!0});var q=(0,s._)((0,g.useState)(null),2),J=q[0],H=q[1],Y=(0,s._)((0,S.q)((0,g.useMemo)(function(){return{queryKey:"view",decode:function(e){return"runs"===e.view?"runs":"evaluations"},encode:function(e){return{view:e,cursor:void 0,statuses:void 0}}}},[])),2),W=Y[0],G=Y[1],Q=null!==(n=K.data)&&void 0!==n?n:K.previousData,X=(0,g.useMemo)(function(){return(null==Q?void 0:Q.autoMaterializeTicks)||[]},[Q]),Z=(0,g.useMemo)(function(){var e;return null!==(e=null==X?void 0:X.map(function(e,n){var t=X[n-1];if(t&&(0,C.g6)(e,n)){var r=(0,i._)({},e);return r.endTimestamp=t.timestamp,r.status=b.izS.FAILURE,r}return e}))&&void 0!==e?e:[]},[JSON.stringify(X.map(function(e){return"".concat(e.id,":").concat(e.status)}))]),ee=(0,g.useCallback)(function(e){B(!!e)},[B]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.x,{padding:{vertical:12,horizontal:24},flex:{direction:"column",gap:12},children:(0,o.jsx)(u.b,{intent:"info",title:"[Experimental] Dagster can automatically materialize assets when criteria are met.",description:(0,o.jsxs)(o.Fragment,{children:["Auto-materialization enables a declarative approach to asset scheduling – instead of defining imperative workflows to materialize your assets, you just describe the conditions under which they should be materialized."," ",(0,o.jsx)("a",{href:"https://docs.dagster.io/concepts/assets/asset-auto-execution",target:"_blank",rel:"noreferrer",children:"Learn more about auto-materialization here"}),"."]})})}),(0,o.jsx)(d.i,{children:(0,o.jsxs)("tbody",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:"Running"}),(0,o.jsx)("td",{children:t.loading?(0,o.jsx)(h.$,{purpose:"body-text"}):(0,o.jsx)(f.X,{format:"switch",checked:!t.paused,disabled:!O,onChange:(e=(0,r._)(function(e){var n;return(0,a.Jh)(this,function(r){switch(r.label){case 0:if(n=e.target.checked)return[3,2];return[4,y({title:"Pause Auto-materializing?",description:"Pausing Auto-materializing will prevent new materializations triggered by an Auto-materializing policy."})];case 1:r.sent(),r.label=2;case 2:return t.setPaused(!n),[2]}})}),function(n){return e.apply(this,arguments)})})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:"Evaluation frequency"}),(0,o.jsx)("td",{children:"~30s"})]})]})}),(0,o.jsx)(c.x,{padding:{vertical:12,horizontal:24},border:"bottom",children:(0,o.jsx)(p.Tj,{children:"Evaluation timeline"})}),Q?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(T.p,{ticks:Z,onHoverTick:ee,onSelectTick:H,exactRange:R,timeRange:12e5,tickGrid:3e5,timeAfter:18e4}),(0,o.jsx)(x.d,{tick:J,isOpen:!!J,close:function(){H(null)}}),"evaluations"===W?(0,o.jsx)(InstanceAutomaterializationEvaluationHistoryTable,{setSelectedTick:H,setTableView:G,setParentStatuses:N,setTimerange:M}):(0,o.jsx)(j.o,{setTableView:G})]}):(0,o.jsxs)(c.x,{padding:{vertical:48},flex:{direction:"row",justifyContent:"center",gap:12,alignItems:"center"},children:[(0,o.jsx)(h.$,{purpose:"body-text"}),(0,o.jsx)("div",{style:{color:m.$()},children:"Loading evaluations…"})]})]})}},95881:function(e,n,t){t.d(n,{A:function(){return InstanceBackfills}});var r=t(85333),i=t(73235),s=t(52322),a=t(40794),o=t(60138),l=t(22139),c=t(63832),u=t(25195),d=t(92364),h=t(83302),f=t(31761),p=t(94611),m=t(91195),g=t(56266),v=t(55237),x=t(68028),j=t(61935),y=t(28252),k=t(62311),b=t(65767),S=t(77376),A=t(16292);function _templateObject(){var e=(0,i._)(["\n  query InstanceHealthForBackfillsQuery {\n    instance {\n      id\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n"]);return _templateObject=function(){return e},e}function _templateObject1(){var e=(0,i._)(["\n  query InstanceBackfillsQuery($status: BulkActionStatus, $cursor: String, $limit: Int) {\n    partitionBackfillsOrError(status: $status, cursor: $cursor, limit: $limit) {\n      ... on PartitionBackfills {\n        results {\n          id\n          status\n          isValidSerialization\n          numPartitions\n          timestamp\n          partitionSetName\n          partitionSet {\n            id\n            name\n            mode\n            pipelineName\n            repositoryOrigin {\n              id\n              repositoryName\n              repositoryLocationName\n            }\n          }\n          error {\n            ...PythonErrorFragment\n          }\n\n          ...BackfillTableFragment\n        }\n      }\n      ...PythonErrorFragment\n    }\n  }\n\n  ","\n  ","\n"]);return _templateObject1=function(){return e},e}var labelForBackfillStatus=function(e){switch(e){case j.Jv3.CANCELED:return"Canceled";case j.Jv3.CANCELING:return"Canceling";case j.Jv3.COMPLETED:return"Completed";case j.Jv3.FAILED:return"Failed";case j.Jv3.REQUESTED:return"In progress"}},w=Object.keys(j.Jv3).map(function(e){var n=labelForBackfillStatus(e);return{label:n,value:e,match:[e,n]}}),InstanceBackfills=function(){(0,x.Px)(),(0,y.j)("Overview | Backfills");var e=(0,a.a)(E),n=(0,A.im)({name:"Status",icon:"status",allValues:w,allowMultipleSelections:!1,closeOnSelect:!0,renderLabel:function(e){var n=e.value;return(0,s.jsx)("div",{children:labelForBackfillStatus(n)})},getStringValue:function(e){return labelForBackfillStatus(e)}}),t=n.state,i=(0,S.m)({filters:[n]}),o=i.button,f=i.activeFiltersJsx,m=(0,b.l)({query:T,variables:{status:t.size>0?Array.from(t)[0]:void 0},pageSize:10,nextCursorForResult:function(e){var n;return"PartitionBackfills"===e.partitionBackfillsOrError.__typename?null===(n=e.partitionBackfillsOrError.results[9])||void 0===n?void 0:n.id:void 0},getResultArray:function(e){return(null==e?void 0:e.partitionBackfillsOrError.__typename)==="PartitionBackfills"?e.partitionBackfillsOrError.results:[]}}),j=m.queryResult,C=m.paginationProps,_=(0,v.C4)(j,v.dT),O=j.loading,P=j.data;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l.x,{padding:{vertical:12,horizontal:20},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(l.x,{flex:{direction:"column",gap:8},children:[(0,s.jsx)("div",{children:o}),f]}),(0,s.jsx)(v.xi,{refreshState:_})]}),function(){if(O&&!P)return(0,s.jsx)(l.x,{padding:{vertical:64},flex:{direction:"column",alignItems:"center"},children:(0,s.jsxs)(l.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,s.jsx)(c.$,{purpose:"body-text"}),(0,s.jsx)("div",{style:{color:u.$()},children:"Loading backfills…"})]})});var n,i=null==P?void 0:P.partitionBackfillsOrError;if((null==i?void 0:i.__typename)==="PythonError")return(0,s.jsx)(g.T9,{error:i});if(!i||!(null==i?void 0:i.results.length))return t.size>0?(0,s.jsx)(l.x,{padding:{vertical:64},children:(0,s.jsx)(d.t,{icon:"no-results",title:"No matching backfills",description:"No backfills were found for this filter."})}):(0,s.jsx)(l.x,{padding:{vertical:64},children:(0,s.jsx)(d.t,{icon:"no-results",title:"No backfills found",description:"This instance does not have any backfill jobs."})});var a=((null===(n=e.data)||void 0===n?void 0:n.instance.daemonHealth.allDaemonStatuses)||[]).filter(function(e){return"BACKFILL"===e.daemonType}).map(function(e){return e.required&&e.healthy}),o=a.length&&a.every(function(e){return e});return(0,s.jsxs)("div",{children:[o?null:(0,s.jsx)(l.x,{padding:{horizontal:24,vertical:16},children:(0,s.jsx)(k.B1,{})}),(0,s.jsx)(p.G,{backfills:i.results.slice(0,10),refetch:j.refetch}),i.results.length>0?(0,s.jsx)(l.x,{margin:{top:16},children:(0,s.jsx)(h.b$,(0,r._)({},C))}):null]})}()]})},E=(0,o.Ps)(_templateObject(),f.O),T=(0,o.Ps)(_templateObject1(),m.B,p.b)},42006:function(e,n,t){t.d(n,{t4:function(){return BackfillPage}});var r=t(81862),i=t(58467),s=t(73235),a=t(22970),o=t(52322),l=t(56675),c=t(40794),u=t(60138),d=t(22139),h=t(63832),f=t(92364),p=t(54266),m=t(12084),g=t(57830),v=t(28888),x=t(17131),j=t(81308),y=t(25195),k=t(28879),b=t.n(k),S=t(64989),A=t.n(S),w=t(77491),E=t.n(w),T=t(2784),C=t(47933),_=t(7267),O=t(35505),P=t(1813),F=t(68651),B=t(67690),z=t(91195),I=t(56266),N=t(55237),L=t(68028),R=t(58701),M=t(35157),U=t(60130),D=t(74711),V=t(61935),K=t(28252),$=t(49313),q=t(68052);function _templateObject(){var e=(0,s._)(["\n  color: ",";\n  font-size: 12px;\n  line-height: 16px;\n"]);return _templateObject=function(){return e},e}function _templateObject1(){var e=(0,s._)(["\n  query BackfillStatusesByAsset($backfillId: String!) {\n    partitionBackfillOrError(backfillId: $backfillId) {\n      ...PartitionBackfillFragment\n      ...PythonErrorFragment\n      ... on BackfillNotFoundError {\n        message\n      }\n    }\n  }\n\n  fragment PartitionBackfillFragment on PartitionBackfill {\n    id\n    status\n    timestamp\n    endTimestamp\n    numPartitions\n    ...BackfillActionsBackfillFragment\n\n    error {\n      ...PythonErrorFragment\n    }\n    assetBackfillData {\n      rootTargetedPartitions {\n        partitionKeys\n        ranges {\n          start\n          end\n        }\n      }\n      assetBackfillStatuses {\n        ... on AssetPartitionsStatusCounts {\n          assetKey {\n            path\n          }\n          numPartitionsTargeted\n          numPartitionsInProgress\n          numPartitionsMaterialized\n          numPartitionsFailed\n        }\n        ... on UnpartitionedAssetStatus {\n          assetKey {\n            path\n          }\n          inProgress\n          materialized\n          failed\n        }\n      }\n    }\n  }\n  ","\n  ","\n"]);return _templateObject1=function(){return e},e}function _templateObject2(){var e=(0,s._)(["\n  query BackfillPartitionsForAssetKey($backfillId: String!, $assetKey: AssetKeyInput!) {\n    partitionBackfillOrError(backfillId: $backfillId) {\n      ... on PartitionBackfill {\n        id\n        partitionsTargetedForAssetKey(assetKey: $assetKey) {\n          partitionKeys\n          ranges {\n            start\n            end\n          }\n        }\n      }\n    }\n  }\n"]);return _templateObject2=function(){return e},e}b().extend(A()),b().extend(E());var BackfillPage=function(){var e=(0,l.x)(),n=(0,_.k6)(),t=(0,_.UO)().backfillId;(0,L.Px)(),(0,K.j)("Backfill | ".concat(t));var i=(0,c.a)(H,{variables:{backfillId:t}}),s=i.data,u=(null==s?void 0:s.partitionBackfillOrError.__typename)==="PartitionBackfill"?s.partitionBackfillOrError:null,k=!u||[V.Jv3.REQUESTED,V.Jv3.CANCELING].includes(u.status),b=(0,N.C4)(i,1e4,k);return(0,o.jsxs)(v.T,{children:[(0,o.jsx)(x.m,{title:(0,o.jsxs)(j.X6,{children:[(0,o.jsx)(C.rU,{to:"/overview/backfills",style:{color:y.$()},children:"Backfills"})," / ",t]}),right:(0,o.jsxs)(d.x,{flex:{gap:12,alignItems:"center"},children:[k?(0,o.jsx)(N.xi,{refreshState:b}):null,u?(0,o.jsx)(P.WH,{backfill:u,refetch:i.refetch,canCancelRuns:u.status===V.Jv3.REQUESTED}):null]})}),function(){if(!s||!s.partitionBackfillOrError)return(0,o.jsx)(d.x,{padding:64,"data-testid":(0,q.N)("page-loading-indicator"),children:(0,o.jsx)(h.$,{purpose:"page"})});if("PythonError"===s.partitionBackfillOrError.__typename)return(0,o.jsx)(I.T9,{error:s.partitionBackfillOrError});if("BackfillNotFoundError"===s.partitionBackfillOrError.__typename)return(0,o.jsx)(f.t,{icon:"no-results",title:s.partitionBackfillOrError.message});var i,l,c,u=s.partitionBackfillOrError;function getRunsUrl(e){var n=[{token:"tag",value:"dagster/backfill=".concat(t)}];switch(e){case"inProgress":n.push({token:"status",value:V.VOA.STARTED},{token:"status",value:V.VOA.QUEUED},{token:"status",value:V.VOA.STARTING},{token:"status",value:V.VOA.CANCELING},{token:"status",value:V.VOA.NOT_STARTED});break;case"complete":n.push({token:"status",value:V.VOA.SUCCESS});break;case"failed":n.push({token:"status",value:V.VOA.FAILURE}),n.push({token:"status",value:V.VOA.CANCELED})}return(0,$.it)(n)}var v=(i=(0,r._)(function(r,i){var s,o,l,c;return(0,a.Jh)(this,function(a){switch(a.label){case 0:if(s={},!i)return[3,2];return[4,e.query({query:Y,variables:{backfillId:t,assetKey:(0,U.W1)(r)}})];case 1:(c="PartitionBackfill"===(l=a.sent()).data.partitionBackfillOrError.__typename?l.data.partitionBackfillOrError.partitionsTargetedForAssetKey:null)&&(null===(o=c.ranges)||void 0===o?void 0:o.length)&&(s={default_range:c.ranges.map(function(e){return"[".concat(e.start,"...").concat(e.end,"]")}).join(",")}),a.label=2;case 2:return[2,n.push((0,D.p)(r,s))]}})}),function(e,n){return i.apply(this,arguments)});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(d.x,{padding:24,flex:{direction:"row",justifyContent:"space-between",wrap:"nowrap",alignItems:"center"},"data-testid":(0,q.N)("backfill-page-details"),children:[(0,o.jsx)(Detail,{label:"Created",detail:(0,o.jsx)(R.E,{timestamp:{ms:Number(1e3*u.timestamp)},timeFormat:{showSeconds:!0,showTimezone:!1}})}),(0,o.jsx)(Detail,{label:"Duration",detail:(0,o.jsx)(Duration,{start:1e3*u.timestamp,end:u.endTimestamp?1e3*u.endTimestamp:null})}),(0,o.jsx)(Detail,{label:"Partition selection",detail:(0,o.jsx)(B.b,{targetPartitionCount:u.numPartitions||0,targetPartitions:null===(l=u.assetBackfillData)||void 0===l?void 0:l.rootTargetedPartitions})}),(0,o.jsx)(Detail,{label:"Status",detail:(0,o.jsx)(F.w,{backfill:u})})]}),(0,o.jsxs)(p.i,{children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{width:"50%"},children:"Asset name"}),(0,o.jsx)("th",{children:(0,o.jsx)(C.rU,{to:getRunsUrl("targeted"),children:"Partitions targeted"})}),(0,o.jsx)("th",{children:(0,o.jsx)(C.rU,{to:getRunsUrl("inProgress"),children:"In progress"})}),(0,o.jsx)("th",{children:(0,o.jsx)(C.rU,{to:getRunsUrl("complete"),children:"Completed"})}),(0,o.jsx)("th",{children:(0,o.jsx)(C.rU,{to:getRunsUrl("failed"),children:"Failed"})})]})}),(0,o.jsx)("tbody",{children:null===(c=u.assetBackfillData)||void 0===c?void 0:c.assetBackfillStatuses.map(function(e){var n,t,r,i;return"AssetPartitionsStatusCounts"===e.__typename?(n=e.numPartitionsTargeted,t=e.numPartitionsInProgress,r=e.numPartitionsMaterialized,i=e.numPartitionsFailed):(n=1,i=e.failed?1:0,t=e.inProgress?1:0,r=e.materialized?1:0),(0,o.jsxs)("tr",{"data-testid":(0,q.N)("backfill-asset-row-".concat((0,M.Je)(e.assetKey))),children:[(0,o.jsx)("td",{children:(0,o.jsxs)(d.x,{flex:{direction:"row",justifyContent:"space-between"},children:[(0,o.jsx)("div",{children:(0,o.jsx)(m.Z,{onClick:function(){return v(e.assetKey,"AssetPartitionsStatusCounts"===e.__typename)},children:e.assetKey.path.join("/")})}),(0,o.jsx)("div",{children:(0,o.jsx)(StatusBar,{targeted:n,inProgress:t,completed:r,failed:i})})]})}),"AssetPartitionsStatusCounts"===e.__typename?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("td",{children:n}),(0,o.jsx)("td",{children:t}),(0,o.jsx)("td",{children:r}),(0,o.jsx)("td",{children:i})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("td",{children:"-"}),(0,o.jsx)("td",{children:t?(0,o.jsx)(g.V,{icon:"spinner",intent:"primary",children:"In progress"}):"-"}),(0,o.jsx)("td",{children:r?(0,o.jsx)(g.V,{intent:"success",children:"Completed"}):"-"}),(0,o.jsx)("td",{children:i?(0,o.jsx)(g.V,{intent:"danger",children:"Failed"}):"-"})]})]},(0,M.Je)(e.assetKey))})})]})]})}()]})},Detail=function(e){var n=e.label,t=e.detail;return(0,o.jsxs)(d.x,{flex:{direction:"column",gap:4},style:{minWidth:"280px"},children:[(0,o.jsx)(J,{children:n}),(0,o.jsx)("div",{children:t})]})};function StatusBar(e){var n=e.targeted,t=e.inProgress,r=e.completed,i=e.failed;return(0,o.jsxs)("div",{style:{borderRadius:"8px",backgroundColor:y.gJ(),display:"grid",gridTemplateColumns:"".concat(100*r/n,"% ").concat(100*i/n,"% ").concat(100*t/n,"%"),gridTemplateRows:"100%",height:"12px",width:"200px",overflow:"hidden"},children:[(0,o.jsx)("div",{style:{background:y.fA()}}),(0,o.jsx)("div",{style:{background:y.FY()}}),(0,o.jsx)("div",{style:{background:y.L$()}})]})}var J=O.ZP.div.withConfig({componentId:"sc-f232c43-0"})(_templateObject(),y.$()),Duration=function(e){var n=e.start,t=e.end,r=(0,i._)((0,T.useReducer)(function(e,n){return e+1},0),2),s=(r[0],r[1]);(0,T.useEffect)(function(){if(!t){var e=setInterval(s,6e4);return function(){return clearInterval(e)}}},[n,t]);var a=t?t-n:Date.now()-n;return(0,o.jsx)("span",{children:formatDuration(a)})},H=(0,u.Ps)(_templateObject1(),z.B,P.V2),Y=(0,u.Ps)(_templateObject2()),formatDuration=function(e){var n=Math.floor(e/6e4%60),t=Math.floor(e/36e5%24),r=Math.floor(e/864e5),i="";return r>0?i+="".concat(r,"d ")+"".concat(t,"h"):t>0?i+="".concat(t,"h ")+"".concat(n,"m"):n>0&&(i+="".concat(n,"m ")+"".concat(Math.floor(e/1e3%60),"s")),i.trim()}},71569:function(e,n,t){t.d(n,{z:function(){return OverviewSchedules}});var r=t(85333),i=t(6692),s=t(2281),a=t(58467),o=t(73235),l=t(52322),c=t(40794),u=t(60138),d=t(22139),h=t(63832),f=t(25195),p=t(92364),m=t(34822),g=t(43180),v=t(2784),x=t(72855),j=t(57830),y=t(88510),k=t(68884),b=t(157),S=t(55658),A=t(77277),w=t(42885),E=t(72349),T=t(86839),C=t(44254),OverviewScheduleTable=function(e){var n=e.repos,t=e.headerCheckbox,r=e.checkedKeys,i=e.onToggleCheckFactory,s=v.useRef(null),a=v.useMemo(function(){return n.map(function(e){var n=e.repoAddress;return(0,C.Uz)(n)})},[n]),o=(0,w.N)(k.y,a),c=o.expandedKeys,u=o.onToggle,d=o.onToggleAll,h=v.useMemo(function(){var e=[];return n.forEach(function(n){var t=n.repoAddress,r=n.schedules;e.push({type:"header",repoAddress:t,scheduleCount:r.length});var i=(0,C.Uz)(t);c.includes(i)&&r.forEach(function(n){e.push({type:"schedule",repoAddress:t,schedule:n})})}),e},[n,c]),f=(0,A.w)(n.map(function(e){return e.repoAddress.name})),p=(0,y.MG)({count:h.length,getScrollElement:function(){return s.current},estimateSize:function(e){var n=h[e];return(null==n?void 0:n.type)==="header"?32:64},overscan:10}),m=p.getTotalSize(),x=p.getVirtualItems();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(E.o,{checkbox:t}),(0,l.jsx)("div",{style:{overflow:"hidden"},children:(0,l.jsx)(S.W2,{ref:s,children:(0,l.jsx)(S.Nh,{$totalHeight:m,children:x.map(function(e){var n=e.index,s=e.key,a=e.size,o=e.start,p=h[n];if("header"===p.type)return(0,l.jsx)(T.vG,{repoAddress:p.repoAddress,height:a,start:o,onToggle:u,onToggleAll:d,expanded:c.includes((0,C.Uz)(p.repoAddress)),showLocation:f.has(p.repoAddress.name),rightElement:(0,l.jsx)(g.u,{content:1===p.scheduleCount?"1 schedule":"".concat(p.scheduleCount," schedules"),placement:"top",children:(0,l.jsx)(j.V,{children:p.scheduleCount})})},s);var m=(0,b.g)(p.repoAddress,p.schedule.name);return(0,l.jsx)(E.i,{name:p.schedule.name,scheduleState:p.schedule.scheduleState,showCheckboxColumn:!!t,checked:r.has(m),onToggleChecked:i(m),repoAddress:p.repoAddress,height:a,start:o},s)})})})})]})},_=t(44392),O=t(89191),P=t(91195),F=t(55237),B=t(71277),z=t(73689),I=t(31761),N=t(30894),L=t(24808),R=t(84826),M=t(30682),U=t(77376),D=t(54242),V=t(8223),K=t(58298),$=t(46988),q=t(37160);function _templateObject(){var e=(0,o._)(["\n  query OverviewSchedulesQuery {\n    workspaceOrError {\n      ... on Workspace {\n        id\n        locationEntries {\n          id\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                schedules {\n                  id\n                  name\n                  description\n                  scheduleState {\n                    id\n                    ...BasicInstigationStateFragment\n                  }\n                }\n              }\n            }\n            ...PythonErrorFragment\n          }\n        }\n      }\n      ...PythonErrorFragment\n    }\n    instance {\n      id\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n  ","\n  ","\n"]);return _templateObject=function(){return e},e}var OverviewSchedules=function(){var e=(0,v.useContext)($.C5),n=e.allRepos,t=e.visibleRepos,o=e.loading,u=n.length,x=(0,a._)((0,B.q)({queryKey:"search",defaults:{search:""}}),2),j=x[0],y=x[1],k=(0,D.A)(),S=(0,V.g)(),A=(0,v.useMemo)(function(){return[k,S]},[k,S]),w=(0,U.m)({filters:A}),E=w.button,T=w.activeFiltersJsx,_=(0,c.a)(J,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),P=_.data,I=_.loading,q=(0,F.C4)(_,F.dT),H=(0,v.useMemo)(function(){var e=(0,O.S)(t);return buildBuckets(P).filter(function(n){var t=n.repoAddress;return e.has((0,C.Uz)(t))})},[P,t]),Y=S.state,W=(0,v.useMemo)(function(){return H.map(function(e){var n=e.schedules,t=(0,s._)(e,["schedules"]);return(0,i._)((0,r._)({},t),{schedules:Y.size?n.filter(function(e){var n=e.scheduleState;return Y.has(n.status)}):n})})},[H,Y]),G=j.trim().toLocaleLowerCase(),Q=G.length>0,X=(0,v.useMemo)(function(){var e=G.toLocaleLowerCase();return W.map(function(n){return{repoAddress:n.repoAddress,schedules:n.schedules.filter(function(n){return n.name.toLocaleLowerCase().includes(e)})}}).filter(function(e){return e.schedules.length>0})},[W,G]),Z=(0,v.useMemo)(function(){return X.some(function(e){return e.schedules.length>0})},[X]),ee=(0,v.useMemo)(function(){return H.map(function(e){var n=e.repoAddress;return e.schedules.filter(function(e){var n=e.scheduleState;return(0,N.i)(n)}).map(function(e){return{repoAddress:n,scheduleName:e.name,scheduleState:e.scheduleState}})}).flat()},[H]),en=(0,v.useMemo)(function(){return ee.map(function(e){var n=e.repoAddress,t=e.scheduleName;return(0,b.g)(n,t)})},[ee]),et=(0,a._)((0,z.a)(en),2),er=et[0].checkedIds,ei=et[1],es=ei.onToggleFactory,ea=ei.onToggleAll,eo=(0,v.useMemo)(function(){var e=new Set(X.map(function(e){var n=e.repoAddress;return e.schedules.map(function(e){var t=e.name;return(0,b.g)(n,t)})}).flat());return en.filter(function(n){return e.has(n)})},[en,X]),el=(0,v.useMemo)(function(){var e=new Set(eo.filter(function(e){return er.has(e)}));return ee.filter(function(n){var t=n.repoAddress,r=n.scheduleName;return e.has((0,b.g)(t,r))})},[eo,ee,er]),ec=en.length>0,eu=el.length,ed=o&&!u||I&&!P;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(d.x,{padding:{horizontal:24,vertical:16},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsxs)(d.x,{flex:{direction:"row",gap:12},children:[E,(0,l.jsx)(m.oi,{icon:"search",value:j,rightElement:ed?(0,l.jsx)(K.W,{tooltipContent:"Loading schedules…"}):void 0,onChange:function(e){y(e.target.value),ea(!1)},placeholder:"Filter by schedule name…",style:{width:"340px"}})]}),(0,l.jsx)(g.u,{content:"You do not have permission to start or stop these schedules",canShow:Z&&!ec,placement:"top-end",useDisabledButtonTooltipFix:!0,children:(0,l.jsx)(L._,{schedules:el,onDone:function(){return q.refetch()}})})]}),T.length?(0,l.jsx)(d.x,{padding:{vertical:8,horizontal:24},border:"top-and-bottom",flex:{direction:"row",gap:8},children:T}):null,I&&!u?(0,l.jsx)(d.x,{padding:64,children:(0,l.jsx)(h.$,{purpose:"page"})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R.K,{daemonHealth:null==P?void 0:P.instance.daemonHealth,padding:{vertical:16,horizontal:24},border:"top"}),function(){if(I&&!P)return(0,l.jsx)(d.x,{flex:{direction:"row",justifyContent:"center"},style:{paddingTop:"100px"},children:(0,l.jsxs)(d.x,{flex:{direction:"row",alignItems:"center",gap:16},children:[(0,l.jsx)(h.$,{purpose:"body-text"}),(0,l.jsx)("div",{style:{color:f.$()},children:"Loading schedules…"})]})});var e=n.length>t.length;return X.length?(0,l.jsx)(OverviewScheduleTable,{headerCheckbox:ec?(0,l.jsx)(M.W,{checkedCount:eu,totalCount:eo.length,onToggleAll:ea}):void 0,repos:X,checkedKeys:er,onToggleCheckFactory:es}):Q?(0,l.jsx)(d.x,{padding:{top:20},children:(0,l.jsx)(p.t,{icon:"search",title:"No matching schedules",description:e?(0,l.jsxs)("div",{children:["No schedules matching ",(0,l.jsx)("strong",{children:j})," were found in the selected code locations"]}):(0,l.jsxs)("div",{children:["No schedules matching ",(0,l.jsx)("strong",{children:j})," were found in your definitions"]})})}):(0,l.jsx)(d.x,{padding:{top:20},children:(0,l.jsx)(p.t,{icon:"search",title:"No schedules",description:e?"No matching schedules were found in the selected code locations":"No matching schedules were found in your definitions"})})}()]})]})},buildBuckets=function(e){if((null==e?void 0:e.workspaceOrError.__typename)!=="Workspace")return[];var n=e.workspaceOrError.locationEntries.map(function(e){return e.locationOrLoadError}),t=[],r=!0,i=!1,s=void 0;try{for(var a,o=n[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var l=a.value;if((null==l?void 0:l.__typename)==="RepositoryLocation"){var c=!0,u=!1,d=void 0;try{for(var h,f=l.repositories[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value,m=p.name,g=p.schedules,v=(0,q.kQ)(m,l.name),x=g.map(function(e){var n=e.name,t=e.scheduleState;return{name:n,scheduleState:t}});x.length>0&&t.push({repoAddress:v,schedules:x})}}catch(e){u=!0,d=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw d}}}}}catch(e){i=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return(0,_.S)(t)},J=(0,u.Ps)(_templateObject(),x.i,P.B,I.O)},57070:function(e,n,t){t.d(n,{n:function(){return OverviewSensors}});var r,i=t(87612),s=t(85333),a=t(6692),o=t(2281),l=t(58467),c=t(73235),u=t(52322),d=t(40794),h=t(60138),f=t(22139),p=t(63832),m=t(25195),g=t(92364),v=t(34822),x=t(43180),j=t(2784),y=t(72855),k=t(57830),b=t(88510),S=t(68884),A=t(22478),w=t(55658),E=t(77277),T=t(42885),C=t(16592),_=t(86839),O=t(44254),OverviewSensorTable=function(e){var n=e.repos,t=e.headerCheckbox,r=e.checkedKeys,i=e.onToggleCheckFactory,s=j.useRef(null),a=j.useMemo(function(){return n.map(function(e){var n=e.repoAddress;return(0,O.Uz)(n)})},[n]),o=(0,T.N)(S.y,a),l=o.expandedKeys,c=o.onToggle,d=o.onToggleAll,h=j.useMemo(function(){var e=[];return n.forEach(function(n){var t=n.repoAddress,r=n.sensors;e.push({type:"header",repoAddress:t,sensorCount:r.length});var i=(0,O.Uz)(t);l.includes(i)&&r.forEach(function(n){e.push({type:"sensor",repoAddress:t,sensor:n})})}),e},[n,l]),f=(0,E.w)(n.map(function(e){return e.repoAddress.name})),p=(0,b.MG)({count:h.length,getScrollElement:function(){return s.current},estimateSize:function(e){var n=h[e];return(null==n?void 0:n.type)==="header"?32:64},overscan:10}),m=p.getTotalSize(),g=p.getVirtualItems();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(C.KF,{checkbox:t}),(0,u.jsx)("div",{style:{overflow:"hidden"},children:(0,u.jsx)(w.W2,{ref:s,children:(0,u.jsx)(w.Nh,{$totalHeight:m,children:g.map(function(e){var n=e.index,s=e.key,a=e.size,o=e.start,p=h[n];if("header"===p.type)return(0,u.jsx)(_.vG,{repoAddress:p.repoAddress,height:a,start:o,onToggle:c,onToggleAll:d,expanded:l.includes((0,O.Uz)(p.repoAddress)),showLocation:f.has(p.repoAddress.name),rightElement:(0,u.jsx)(x.u,{content:1===p.sensorCount?"1 sensor":"".concat(p.sensorCount," sensors"),placement:"top",children:(0,u.jsx)(k.V,{children:p.sensorCount})})},s);var m=(0,A.x)(p.repoAddress,p.sensor.name);return(0,u.jsx)(C.Rx,{name:p.sensor.name,sensorState:p.sensor.sensorState,showCheckboxColumn:!!t,checked:r.has(m),onToggleChecked:i(m),repoAddress:p.repoAddress,height:a,start:o},s)})})})})]})},P=t(44392),F=t(89191),B=t(91195),z=t(55237),I=t(61935),N=t(71277),L=t(73689),R=t(31761),M=t(30894),U=t(67802),D=t(56692),V=t(30682),K=t(77376),$=t(54242),q=t(8223),J=t(16292),H=t(58298),Y=t(46988),W=t(37160);function _templateObject(){var e=(0,c._)(["\n  query OverviewSensorsQuery {\n    workspaceOrError {\n      ... on Workspace {\n        id\n        locationEntries {\n          id\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                sensors {\n                  id\n                  name\n                  description\n                  sensorType\n                  sensorState {\n                    id\n                    ...BasicInstigationStateFragment\n                  }\n                }\n              }\n            }\n            ...PythonErrorFragment\n          }\n        }\n      }\n      ...PythonErrorFragment\n    }\n    instance {\n      id\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n  ","\n  ","\n"]);return _templateObject=function(){return e},e}function toSetFilterValue(e){var n=C.W_[e].name;return{label:n,value:{type:e,label:n},match:[n]}}var G=(r={},(0,i._)(r,I.dEY.ASSET,toSetFilterValue(I.dEY.ASSET)),(0,i._)(r,I.dEY.AUTO_MATERIALIZE,toSetFilterValue(I.dEY.AUTO_MATERIALIZE)),(0,i._)(r,I.dEY.FRESHNESS_POLICY,toSetFilterValue(I.dEY.FRESHNESS_POLICY)),(0,i._)(r,I.dEY.MULTI_ASSET,toSetFilterValue(I.dEY.MULTI_ASSET)),(0,i._)(r,I.dEY.RUN_STATUS,toSetFilterValue(I.dEY.RUN_STATUS)),(0,i._)(r,I.dEY.STANDARD,toSetFilterValue(I.dEY.STANDARD)),r),Q=Object.values(G),OverviewSensors=function(){var e=(0,j.useContext)(Y.C5),n=e.allRepos,t=e.visibleRepos,r=e.loading,i=n.length,c=(0,l._)((0,N.q)({queryKey:"search",defaults:{search:""}}),2),h=c[0],y=c[1],k=(0,$.A)(),b=(0,q.g)(),S=(0,l._)((0,j.useState)(function(){return new Set}),2),w=S[0],E=S[1],T=(0,J.im)({name:"Sensor type",allValues:Q,icon:"sensors",getStringValue:function(e){return e.label},state:(0,j.useMemo)(function(){return new Set(Array.from(w).map(function(e){return G[e].value}))},[w]),renderLabel:function(e){var n=e.value;return(0,u.jsx)("span",{children:n.label})},onStateChanged:function(e){E(new Set(Array.from(e).map(function(e){return e.type})))}}),C=(0,j.useMemo)(function(){return[k,b,T]},[k,b,T]),_=(0,K.m)({filters:C}),P=_.button,B=_.activeFiltersJsx,I=(0,d.a)(X,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),R=I.data,W=I.loading,Z=(0,z.C4)(I,z.dT),ee=(0,j.useMemo)(function(){var e=(0,F.S)(t);return buildBuckets(R).filter(function(n){var t=n.repoAddress;return e.has((0,O.Uz)(t))})},[R,t]),en=b.state,et=(0,j.useMemo)(function(){return ee.map(function(e){var n=e.sensors,t=(0,o._)(e,["sensors"]);return(0,a._)((0,s._)({},t),{sensors:n.filter(function(e){var n=e.sensorState,t=e.sensorType;return(!en.size||!!en.has(n.status))&&(!w.size||!!w.has(t))})})})},[ee,en,w]),er=h.trim().toLocaleLowerCase(),ei=er.length>0,es=(0,j.useMemo)(function(){var e=er.toLocaleLowerCase();return et.map(function(n){return{repoAddress:n.repoAddress,sensors:n.sensors.filter(function(n){return n.name.toLocaleLowerCase().includes(e)})}}).filter(function(e){return e.sensors.length>0})},[et,er]),ea=(0,j.useMemo)(function(){return es.some(function(e){return e.sensors.length>0})},[es]),eo=(0,j.useMemo)(function(){return ee.map(function(e){var n=e.repoAddress;return e.sensors.filter(function(e){var n=e.sensorState;return(0,M.i)(n)}).map(function(e){return{repoAddress:n,sensorName:e.name,sensorState:e.sensorState}})}).flat()},[ee]),el=(0,j.useMemo)(function(){return eo.map(function(e){var n=e.repoAddress,t=e.sensorName;return(0,A.x)(n,t)})},[eo]),ec=(0,l._)((0,L.a)(el),2),eu=ec[0].checkedIds,ed=ec[1],eh=ed.onToggleFactory,ef=ed.onToggleAll,ep=(0,j.useMemo)(function(){var e=new Set(es.map(function(e){var n=e.repoAddress;return e.sensors.map(function(e){var t=e.name;return(0,A.x)(n,t)})}).flat());return el.filter(function(n){return e.has(n)})},[el,es]),em=(0,j.useMemo)(function(){var e=new Set(ep.filter(function(e){return eu.has(e)}));return eo.filter(function(n){var t=n.repoAddress,r=n.sensorName;return e.has((0,A.x)(t,r))})},[ep,eo,eu]),eg=el.length>0,ev=em.length,ex=r&&!i||W&&!R;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(f.x,{padding:{horizontal:24,vertical:16},flex:{direction:"row",alignItems:"center",justifyContent:"space-between",gap:12,grow:0},children:[(0,u.jsxs)(f.x,{flex:{direction:"row",gap:12},children:[P,(0,u.jsx)(v.oi,{icon:"search",value:h,rightElement:ex?(0,u.jsx)(H.W,{tooltipContent:"Loading sensors…"}):void 0,onChange:function(e){return y(e.target.value)},placeholder:"Filter by sensor name…",style:{width:"340px"}})]}),(0,u.jsxs)(f.x,{flex:{direction:"row",gap:12,alignItems:"center"},children:[(0,u.jsx)(z.xi,{refreshState:Z}),(0,u.jsx)(x.u,{content:"You do not have permission to start or stop these schedules",canShow:ea&&!eg,placement:"top-end",useDisabledButtonTooltipFix:!0,children:(0,u.jsx)(U.b,{sensors:em,onDone:function(){return Z.refetch()}})})]})]}),B.length?(0,u.jsx)(f.x,{padding:{vertical:8,horizontal:24},border:"top-and-bottom",flex:{direction:"row",gap:8},children:B}):null,W&&!i?(0,u.jsx)(f.x,{padding:64,children:(0,u.jsx)(p.$,{purpose:"page"})}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(D.F,{daemonHealth:null==R?void 0:R.instance.daemonHealth,padding:{vertical:16,horizontal:24},border:"top"}),function(){if(W&&!R)return(0,u.jsx)(f.x,{flex:{direction:"row",justifyContent:"center"},style:{paddingTop:"100px"},children:(0,u.jsxs)(f.x,{flex:{direction:"row",alignItems:"center",gap:16},children:[(0,u.jsx)(p.$,{purpose:"body-text"}),(0,u.jsx)("div",{style:{color:m.$()},children:"Loading sensors…"})]})});var e=n.length>t.length;return es.length?(0,u.jsx)(OverviewSensorTable,{headerCheckbox:eg?(0,u.jsx)(V.W,{checkedCount:ev,totalCount:ep.length,onToggleAll:ef}):void 0,repos:es,checkedKeys:eu,onToggleCheckFactory:eh}):ei?(0,u.jsx)(f.x,{padding:{top:20},children:(0,u.jsx)(g.t,{icon:"search",title:"No matching sensors",description:e?(0,u.jsxs)("div",{children:["No sensors matching ",(0,u.jsx)("strong",{children:h})," were found in the selected code locations"]}):(0,u.jsxs)("div",{children:["No sensors matching ",(0,u.jsx)("strong",{children:h})," were found in your definitions"]})})}):(0,u.jsx)(f.x,{padding:{top:20},children:(0,u.jsx)(g.t,{icon:"search",title:"No sensors",description:e?"No sensors were found in the selected code locations":"No sensors were found in your definitions"})})}()]})]})},buildBuckets=function(e){if((null==e?void 0:e.workspaceOrError.__typename)!=="Workspace")return[];var n=e.workspaceOrError.locationEntries.map(function(e){return e.locationOrLoadError}),t=[],r=!0,i=!1,s=void 0;try{for(var a,o=n[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var l=a.value;if((null==l?void 0:l.__typename)==="RepositoryLocation"){var c=!0,u=!1,d=void 0;try{for(var h,f=l.repositories[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value,m=p.name,g=p.sensors,v=(0,W.kQ)(m,l.name);g.length>0&&t.push({repoAddress:v,sensors:g})}}catch(e){u=!0,d=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw d}}}}}catch(e){i=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return(0,P.S)(t)},X=(0,h.Ps)(_templateObject(),y.i,B.B,R.O)},44392:function(e,n,t){t.d(n,{S:function(){return sortRepoBuckets}});var r=t(82550),i=t(44254),sortRepoBuckets=function(e){return(0,r._)(e).sort(function(e,n){var t=(0,i.Uz)(e.repoAddress),r=(0,i.Uz)(n.repoAddress);return t.localeCompare(r)})}},89191:function(e,n,t){t.d(n,{S:function(){return visibleRepoKeys}});var r=t(37160),i=t(44254),visibleRepoKeys=function(e){return new Set(e.map(function(e){return(0,i.Uz)((0,r.kQ)(e.repository.name,e.repositoryLocation.name))}))}},58298:function(e,n,t){t.d(n,{W:function(){return SearchInputSpinner}});var r=t(52322),i=t(58467),s=t(2784),useDelayedState=function(e){var n=(0,i._)((0,s.useState)(!1),2),t=n[0],r=n[1];return(0,s.useEffect)(function(){var n=setTimeout(function(){return r(!0)},e);return function(){return clearTimeout(n)}},[e]),t},a=t(22139),o=t(43180),l=t(63832),SearchInputSpinner=function(e){var n=e.tooltipContent;return useDelayedState(2e3)?(0,r.jsx)(a.x,{margin:{top:1},children:(0,r.jsx)(o.u,{placement:"top",canShow:!!n,content:n||"",children:(0,r.jsx)(l.$,{purpose:"body-text"})})}):null}}}]);
//# sourceMappingURL=913.a3e8faf750b2669d.js.map